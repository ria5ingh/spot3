<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rewind Radio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:       #D1DFF9;
      --surface:  #CDE3FF;
      --border:   #9999CC;
      --accent:   #0000ac;
      --accent2:  #C384FA;
      --text:     #5863F9;
      --muted:    #0c19d6;
      --radius:   14px;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      /*background: var(--bg);*/
      color: var(--text);
      min-height: 100vh;
      padding: 2rem 1rem 4rem;
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(
        180deg,
        #f6cef6 0%,
        #747dd8 35%,
        #eb9ff7 70%,
        #71bcda 100%
      );
    }

    .container { max-width: 680px; margin: 0 auto; }

    header { text-align: center; margin-bottom: 2.5rem; }
    header .note { font-size: 1.5rem; margin-bottom: .5rem; }
    header h1 {
      font-family: 'Lora', serif;
      font-size: 2.4rem;
      color: var(--accent);
      line-height: 1.15;
    }
    header p {
      margin-top: .6rem;
      color: var(--muted);
      font-size: .95rem;
      font-weight: 300;
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 2rem;
      margin-bottom: 1.5rem;
    }
    .card h2 {
      font-family: 'Lora', serif;
      font-size: 1.15rem;
      margin-bottom: 1.2rem;
      color: var(--accent);
    }

    .field { margin-bottom: 1.2rem; }
    label {
      display: block;
      font-size: .82rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: .06em;
      color: var(--muted);
      margin-bottom: .4rem;
    }
    label .optional {
      font-weight: 300;
      text-transform: none;
      letter-spacing: 0;
      font-size: .8rem;
    }
    input, textarea {
      width: 100%;
      padding: .65rem .85rem;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      background: var(--bg);
      font-family: 'DM Sans', sans-serif;
      font-size: .95rem;
      color: var(--text);
      transition: border-color .2s;
      resize: vertical;
    }
    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent2);
    }
    input::placeholder, textarea::placeholder { color: #9999CC; }

    button.generate {
      width: 100%;
      padding: .9rem;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-family: 'DM Sans', sans-serif;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background .2s, transform .1s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
    }
    button.generate:hover { background: #9999CC; }
    button.generate:active { transform: scale(.98); }
    button.generate:disabled { background: #9999CC; cursor: not-allowed; }

    .spinner {
      width: 18px; height: 18px;
      border: 2px solid rgba(255,255,255,.4);
      border-top-color: #9999CC;
      border-radius: 50%;
      animation: spin .7s linear infinite;
      display: none;
    }
    button.generate.loading .spinner { display: block; }
    button.generate.loading .btn-text::after { content: "Building playlistâ€¦"; }
    button.generate:not(.loading) .btn-text::after { content: "  Generate Playlist"; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .status {
      text-align: center;
      padding: .8rem;
      border-radius: 8px;
      font-size: .9rem;
      margin-bottom: 1.5rem;
      display: none;
    }
    .status.error   { background: #9999CC; color: #b02020; display: block; }
    .status.info    { background: #9999CC; color: #1a5a8a; display: block; }

    footer {
      text-align: center;
      margin-top: 3rem;
      font-size: .78rem;
      color: var(--muted);
    }
  </style>
</head>

<body>
<div class="container">

  <header>
    <div class="note">ðŸŽµ</div>
    <h1>Rewind Radio</h1>
    <p> a personalized radio to reconnect with cherished memories</p>
  </header>

  <div class="card">
    <h2>Patient Profile</h2>
    <form id="profile-form">

      <div class="field">
        <label>Birth Year</label>
        <input type="number" id="birth_year" placeholder="1942" min="1900" max="2005" />
      </div>

      <div class="field">
        <label>Where Patient Grew Up</label>
        <input type="text" id="hometown" placeholder="New Orleans" />
      </div>

      <div class="field">
        <label>Language</label>
        <input type="text" id="language" placeholder="English, Hindi" />
      </div>

      <div class="field">
        <label>Culture <span class="optional">(optional)</span></label>
        <input type="text" id="culture" placeholder="African American, Hispanic" />
      </div>

      <div class="field">
        <label>Life Period <span class="optional">(optional)</span></label>
        <input type="text" id="life_period" placeholder="Childhood, Teens, 30s" />
      </div>

      <div class="field">
        <label> Familiar Songs <span class="optional">(optional â€” up to 3)</span></label>
        <textarea id="resonant_songs" rows="3"
          placeholder='"Fly Me to the Moon" - Frank Sinatra'></textarea>
      </div>

      <button type="submit" class="generate" id="gen-btn">
        <div class="spinner"></div>
        <span class="btn-text"></span>
      </button>
    </form>
  </div>

  <div class="status" id="status"></div>
</div>

<footer>muscial comfort built for alzheimer's patients | powered by Gemini &amp; Last.fm</footer>

<script>
  const form   = document.getElementById("profile-form");
  const btn    = document.getElementById("gen-btn");
  const status = document.getElementById("status");

  function setStatus(msg, type = "info") {
    status.textContent = msg;
    status.className = `status ${type}`;
  }
  function clearStatus() { status.className = "status"; }

  function setLoading(on) {
    btn.disabled = on;
    btn.classList.toggle("loading", on);
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    clearStatus();

    const birth_year     = document.getElementById("birth_year").value.trim();
    const hometown       = document.getElementById("hometown").value.trim();
    const language       = document.getElementById("language").value.trim();
    const culture        = document.getElementById("culture").value.trim();
    const life_period    = document.getElementById("life_period").value.trim();
    const resonant_songs = document.getElementById("resonant_songs").value.trim();

    if (!birth_year && !hometown && !language) {
      setStatus("Please fill in at least Birth Year, Hometown, or Language.", "error");
      return;
    }

    setLoading(true);
    setStatus("Analysing profile and generating music tagsâ€¦");

    try {
      const res = await fetch("/api/generate-playlist", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ birth_year, hometown, language, culture, life_period, resonant_songs }),
      });

      const data = await res.json();
      if (!res.ok) throw new Error(data.error || "Server error");

      // Store results for the results page
      sessionStorage.setItem("memory_melody_result", JSON.stringify(data));

      // Navigate to page 2
      window.location.href = "/results.html";
    } catch (err) {
      setStatus(`Error: ${err.message}`, "error");
    } finally {
      setLoading(false);
    }
  });
</script>
</body>
</html>